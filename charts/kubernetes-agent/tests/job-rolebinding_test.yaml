suite: "job permissions"
templates:
- templates/job-rolebinding.yaml
tests:
- it: "is created when role rules set"
  set:
    jobServiceAccount:
      role:
        rules:
        - apiGroups:
          - '*'
          resources: ["pods"]
          verbs: ["get", "watch", "list"]
  asserts:
  - hasDocuments:
      count: 1

- it: "is not created when clusterrole rules are set"
  set:
    jobServiceAccount:
      clusterRole:
        rules:
        - apiGroups:
          - '*'
          resources:
          - ["pods"]
          verbs:
          - ["get", "watch", "list"]
  asserts:
  - hasDocuments:
      count: 0

- it: "is not created when no custom rules are set"
  asserts:
  - hasDocuments:
      count: 0
