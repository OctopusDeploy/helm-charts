suite: "job permissions"
templates:
- templates/job-clusterrole.yaml
tests:
- it: "cluster role can have rules overridden"
  set:
    jobServiceAccount:
      clusterRole:
        rules:
        - apiGroups:
          - '*'
          resources: ["pods"]
          verbs: ["get", "watch", "list"]
  asserts:
  - contains:
      path: rules
      content:
        apiGroups:
        - '*'
        resources: ["pods"]
        verbs: ["get", "watch", "list"]

- it: "is not created when role rules are set"
  set:
    jobServiceAccount:
      role:
        rules:
        - apiGroups:
          - '*'
          resources:
          - ["pods"]
          verbs:
          - ["get", "watch", "list"]
  asserts:
  - hasDocuments:
      count: 0

- it: "should match snapshot"
  asserts:
  - matchSnapshot: {}
